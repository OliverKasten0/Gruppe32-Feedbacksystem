<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>SessionManager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        .flex-container {
            display: flex;
            border: 0px solid #000a65;
            justify-content: center;
            align-items: start;
            height: 70vh;
            margin-top: 10px;
            margin-bottom: 20px;
        }

        .session {
            border: 2px solid #676774;
            padding: 10px;
            border-radius: 5px;
            width: 500px;
            font-size: 20px;
            background-color: #839aff;
            justify-content: left;
            cursor: pointer;
        }

        .header {
            font-size: 36pt;
            font-weight: bold;
            background-color: #839aff;
            color: #000a65;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            text-align: center;
        }

        .deletebutton {
            color: red;
            background-color: white;
            width: 50px;
            height: 50px;
            font-size: 25px;
            justify-content: center;
            text-align: center;
            border-radius: 5px;
        }

        .editbutton {
            color: black;
            background-color: white;
            width: 50px;
            height: 50px;
            font-size: 25px;
            justify-content: center;
            text-align: center;
            border-radius: 5px;
        }

        .addbutton {
            position: relative;
            /* anchor for absolute icon */
            width: 100%;
            height: 50px;
            background-color: white;
            color: black;
            font-size: 25px;
            border-radius: 5px;
            padding: 0 15px;
            cursor: pointer;
            font-family: inherit;
            margin-bottom: 5px;
        }

        .backbutton {
            color: black;
            background-color: white;
            width: 50px;
            height: 50px;
            font-size: 25px;
            justify-content: center;
            text-align: center;
            border-radius: 5px;
        }

        .btn-text {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            white-space: nowrap;
            line-height: 1;
            font-weight: bold;
        }

        .btn-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
        }

        .qrbutton {
            color: #839aff;
            background-color: white;
            width: 50px;
            height: 50px;
            font-size: 25px;
            justify-content: center;
            text-align: center;
            border-radius: 5px;
        }

        .deletebutton:hover {
            background-color: #f1f1f1;
            cursor: pointer;
        }

        .editbutton:hover {
            background-color: #f1f1f1;
            cursor: pointer;
        }

        .addbutton:hover {
            background-color: #f1f1f1;
            cursor: pointer;
        }

        .qrbutton:hover {
            background-color: #f1f1f1;
            cursor: pointer;
        }

        .backbutton:hover {
            background-color: #f1f1f1;
            cursor: pointer;
        }

        .delete-success-message {
            color: red;
            font-weight: bold;
            display: none;
        }

        .edit-success-message {
            color: #839aff;
            font-weight: bold;
            display: none;
        }

        .add-success-message {
            color: #839aff;
            font-weight: bold;
            display: none;
        }

        .title {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin-right: 15px;
        }

        .headertitle {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            margin: 0;
            white-space: nowrap;
        }

        .titlebox {
            display: flex;
            margin: 15px auto 10px;
            justify-content: center;
            align-items: baseline;
        }

    </style>
</head>

<body>
    <script>
        let sessionCount = 1;
        let showAddAlert = true;

        function hideMessages() {
            let del = document.getElementById("deleteSessionSuccess");
            let edit = document.getElementById("editSessionSuccess");
            let add = document.getElementById("addSessionSuccess");
            del.style.display = "none";
            edit.style.display = "none";
            add.style.display = "none";
        }

        function deleteSession(sessionId) {
            let session = document.getElementById(sessionId);
            session.remove();
            hideMessages();
            showSuccessMessage("deleteSessionSuccess");
        }

        function editSession(sessionId) {
            alert('This is a popup where the user would normally be able to edit the details of a session.\nCurrently not available in this prototype!');
            hideMessages();
            showSuccessMessage("editSessionSuccess");
        }

        function showQRCode(sessionId) {
            alert('Normally, a pop-up with the QR code for this specific session would appear here for the students to scan.\nSince this is a prototype, this functionality is currently unavailable.');
        }

        function addSession() {
            if (showAddAlert) {
                alert('This is a popup where the user would normally be able to add a new session.\nIn this prototype only a dummy session without editable details will be added.\nThis message will not be displayed again.');
                showAddAlert = false;
            }

            const template = document.getElementById("sessionTemplate");
            const clone = template.cloneNode(true); // deep clone
            sessionCount++;
            const newId = "session" + sessionCount;
            clone.id = newId;
            clone.style.display = "";

            // Update buttons to use correct IDs
            const buttons = clone.querySelectorAll("button");
            buttons.forEach(btn => {
                if (btn.classList.contains("editbutton")) {
                    btn.setAttribute("onclick", `editSession('${newId}')`);
                }
                if (btn.classList.contains("deletebutton")) {
                    btn.setAttribute("onclick", `deleteSession('${newId}')`);
                }
                if (btn.classList.contains("qrbutton")) {
                    //btn.setAttribute("onclick", `showQRCode('${newId}')`);
                    btn.setAttribute("onclick", "location.href='qrcode.html'");
                }
            });

            // Append after the last session row
            const table = document.getElementById("itemTable");
            const lastSession = table.querySelector(`tr[id^="session"]:last-of-type`);
            lastSession.after(clone);

            hideMessages();
            showSuccessMessage("addSessionSuccess");
        }

        function showSuccessMessage(elementId) {
            let msg = document.getElementById(elementId);
            msg.style.display = "inline";
            setTimeout(function () {
                msg.style.display = "none";
            }, 3000);
        }
    </script>
    <div class="header">
        <button title="Zurück" class="backbutton" onclick="history.back()">
            <i class="fa fa-chevron-left" style="margin-left: -5px;"></i>
        </button>
        <span class="headertitle">Kursname: Session Manager</span>
    </div>

    <div class="titlebox">
        <span class="title">Sessions verwalten</span>

        <span class="success-messages" style="text-align: center;">
            <span id="deleteSessionSuccess" class="delete-success-message">Session erfolgreich
                gelöscht!</span>
            <span id="editSessionSuccess" class="edit-success-message">Session erfolgreich
                bearbeitet!</span>
            <span id="addSessionSuccess" class="edit-success-message">Session erfolgreich
                hinzugefügt!</span>
        </span>
    </div>



    <!-- one container for all feedback elements -->
    <div id="sessionContainer" class="flex-container">
        <div style="width: 700px;">
            <div>
                <hr class="divider" style="margin-bottom: 15px">
                <button class="addbutton" onclick="addSession()">
                    <span class="btn-text">Neue Session erstellen</span>
                    <i class="fa fa-plus btn-icon"></i>
                </button>
            </div>
            <table id="itemTable" style="align-items: center; text-align: center; padding: 5px;">
                <tr id="sessionTemplate" style="text-align: left; display: none">
                    <td class="session" onclick="location.href='feedbackProf.html'" style="vertical-align: middle;">
                        <div style="display: flex; align-items: center;">
                            <div><span style="font-weight: bold" ;>Session X</span>
                                <br>
                                <span>01.01.1970 - 00:00</span>
                            </div>
                            </span>
                            <span style="text-align: right; flex: 1; font-weight: bold; font-size: 30px;"><i
                                    class="fa fa-chevron-right"></i>
                            </span>
                        </div>
                    </td>
                    <td>
                        <button title="Session Details bearbeiten" class="editbutton"
                            onclick="editSession('sessionTemplate')">
                            <i class="fa fa-pencil "></i>
                        </button>
                    </td>
                    <td>
                        <button title="QR Code anzeigen" class="qrbutton" onclick="location.href='qrcode.html'">
                            <!--onclick="showQRCode('sessionTemplate')"> -->
                            <i class="fa fa-qrcode "></i>
                        </button>
                    </td>
                    <td>
                        <button title="Session löschen" class="deletebutton" onclick="deleteSession('sessionTemplate')">
                            <i class="fa fa-trash-o "></i>
                        </button>
                    </td>
                </tr>
                <tr id="session1" style="text-align: left">
                    <td class="session" onclick="location.href='feedbackProf.html'" style="vertical-align: middle;">
                        <div style="display: flex; align-items: center;">
                            <div><span style="font-weight: bold" ;>Session X</span>
                                <br>
                                <span>01.01.1970 - 00:00</span>
                            </div>
                            </span>
                            <span style="text-align: right; flex: 1; font-weight: bold; font-size: 30px;"><i
                                    class="fa fa-chevron-right"></i>
                            </span>
                        </div>
                    </td>
                    <td>
                        <button title="Session Details bearbeiten" class="editbutton" onclick="editSession('session1')">
                            <i class="fa fa-pencil "></i>
                        </button>
                    </td>
                    <td>
                        <button title="QR Code anzeigen" class="qrbutton" onclick="location.href='qrcode.html'">
                            <!--onclick="showQRCode('session1')"> -->
                            <i class="fa fa-qrcode "></i>
                        </button>
                    </td>
                    <td>
                        <button title="Session löschen" class="deletebutton" onclick="deleteSession('session1')">
                            <i class="fa fa-trash-o "></i>
                        </button>
                    </td>
                </tr>
            </table>
        </div>

    </div>
</body>


</html>